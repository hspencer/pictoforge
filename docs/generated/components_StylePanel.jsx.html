<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/StylePanel.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/StylePanel.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from 'react';
import ReactDOM from 'react-dom';
import { Palette, Eye, EyeOff, Edit2, Plus, Trash2, GripVertical } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { useI18n } from '@/hooks/useI18n';
import PathDebugger from './PathDebugger';
import SVGMetadataEditor from './SVGMetadataEditor';
import Draggable from 'react-draggable';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogPortal,
  DialogOverlay,
} from '@/components/ui/dialog';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Popover } from './ui/popover';

/**
 * Componente para el panel de estilos CSS
 */

export const StylePanel = ({
  svgData,
  selectedElement,
  svgContent,
  onStyleChange,
  onSVGUpdate
}) => {
  const { t } = useI18n();
  const [activeStyles, setActiveStyles] = React.useState(new Set());
  const [editingStyle, setEditingStyle] = React.useState(null);
  const [editModalOpen, setEditModalOpen] = React.useState(false);

  // Lista de propiedades CSS comunes para SVG
  const commonSVGProperties = [
    'fill', 'stroke', 'stroke-width', 'stroke-linecap', 'stroke-linejoin',
    'stroke-dasharray', 'stroke-dashoffset', 'opacity', 'fill-opacity',
    'stroke-opacity', 'transform', 'filter', 'clip-path', 'mask'
  ];

  /**
   * Obtiene los estilos disponibles del SVG
   */
  const getAvailableStyles = () => {
    if (!svgData?.styles) return [];
    
    return Object.entries(svgData.styles).map(([className, properties]) => ({
      name: className,
      properties: properties,
      isActive: selectedElement?.className?.includes(className) || false
    }));
  };

  /**
   * Aplica o remueve un estilo del elemento seleccionado
   */
  const toggleStyle = (styleName) => {
    if (!selectedElement) return;

    const currentClasses = selectedElement.className.split(' ').filter(c => c.trim());
    const hasStyle = currentClasses.includes(styleName);

    let newClasses;
    if (hasStyle) {
      newClasses = currentClasses.filter(c => c !== styleName);
    } else {
      newClasses = [...currentClasses, styleName];
    }

    onStyleChange?.(selectedElement.id, newClasses.join(' '));
  };

  /**
   * Parsea las propiedades CSS para mostrarlas de forma legible
   */
  const parseStyleProperties = (properties) => {
    return properties
      .split(';')
      .filter(prop => prop.trim())
      .map(prop => {
        const [key, value] = prop.split(':').map(s => s.trim());
        return { key, value };
      });
  };

  /**
   * Obtiene los estilos CSS inline para el preview (fill, stroke, etc.)
   */
  const getStylePreview = (properties) => {
    const props = parseStyleProperties(properties);
    const style = {};

    props.forEach(prop => {
      if (prop.key === 'fill') style.backgroundColor = prop.value;
      if (prop.key === 'stroke') style.borderColor = prop.value;
      if (prop.key === 'stroke-width') style.borderWidth = prop.value;
      if (prop.key === 'opacity') style.opacity = prop.value;
    });

    // Si no hay fill, usar transparente
    if (!style.backgroundColor) style.backgroundColor = 'transparent';
    // Si no hay stroke, usar border por defecto
    if (!style.borderColor) style.borderColor = '#e5e7eb';
    if (!style.borderWidth) style.borderWidth = '2px';

    return style;
  };

  /**
   * Abre el modal de edición de un estilo
   */
  const handleStyleDoubleClick = (style) => {
    setEditingStyle({
      name: style.name,
      properties: parseStyleProperties(style.properties)
    });
    setEditModalOpen(true);
  };

  /**
   * Guarda los cambios del estilo editado
   */
  const handleSaveStyle = () => {
    // TODO: Implementar guardado de estilos
    console.log('Guardando estilo:', editingStyle);
    setEditModalOpen(false);
    setEditingStyle(null);
  };

  /**
   * Crea un nuevo estilo vacío
   */
  const handleCreateNewStyle = () => {
    setEditingStyle({
      name: 'nuevo-estilo',
      properties: [
        { key: 'fill', value: '#000000' },
        { key: 'stroke', value: '#000000' }
      ]
    });
    setEditModalOpen(true);
  };

  /**
   * Elimina el estilo actual
   */
  const handleDeleteStyle = () => {
    // TODO: Implementar eliminación de estilos
    console.log('Eliminando estilo:', editingStyle?.name);
    setEditModalOpen(false);
    setEditingStyle(null);
  };

  /**
   * Obtiene las propiedades disponibles (no utilizadas)
   */
  const getAvailableProperties = () => {
    if (!editingStyle) return commonSVGProperties;
    const usedKeys = editingStyle.properties.map(p => p.key);
    return commonSVGProperties.filter(prop => !usedKeys.includes(prop));
  };

  const availableStyles = getAvailableStyles();

  return (
    &lt;div className="h-full flex flex-col bg-muted/20">
      &lt;div className="p-4 border-b bg-background flex items-center justify-between">
        &lt;h3 className="font-semibold text-sm flex items-center gap-2">
          &lt;Palette size={16} />
          {t('styles')}
        &lt;/h3>
        &lt;Button
          variant="outline"
          size="sm"
          onClick={handleCreateNewStyle}
          className="h-7 w-7 p-0"
          title={t('createNewStyle')}
        >
          &lt;Plus size={14} />
        &lt;/Button>
      &lt;/div>

      &lt;div className="flex-1 overflow-auto p-4">
        {availableStyles.length === 0 ? (
          &lt;div className="text-center text-muted-foreground py-8">
            &lt;Palette size={32} className="mx-auto mb-2 opacity-50" />
            &lt;p className="text-sm">{t('noStylesDefined')}&lt;/p>
          &lt;/div>
        ) : (
          &lt;div className="flex flex-wrap gap-2">
            {availableStyles.map((style) => {
              const previewStyle = getStylePreview(style.properties);

              return (
                &lt;div
                  key={style.name}
                  className={`
                    flex flex-col items-center gap-1 p-2 rounded-lg cursor-pointer
                    transition-all duration-200 relative
                    ${style.isActive
                      ? 'bg-background border border-primary'
                      : 'hover:bg-background/50 border border-transparent'
                    }
                  `}
                  onClick={() => toggleStyle(style.name)}
                  onDoubleClick={() => handleStyleDoubleClick(style)}
                  title={t('clickToApplyDoubleClickToEdit')}
                >
                  {/* Círculo de preview con el estilo aplicado */}
                  &lt;div
                    className="w-10 h-10 rounded-full flex-shrink-0"
                    style={{
                      ...previewStyle,
                      borderStyle: 'solid',
                      opacity: style.isActive ? 1 : 0.7
                    }}
                  />

                  {/* Nombre del estilo (sin punto) */}
                  &lt;span className={`
                    text-xs font-medium text-center max-w-[60px] truncate
                    ${style.isActive ? 'text-primary' : 'text-foreground'}
                  `}>
                    {style.name}
                  &lt;/span>

                  {/* Indicador de activo */}
                  {style.isActive &amp;&amp; (
                    &lt;div className="absolute top-1 right-1">
                      &lt;Eye size={10} className="text-primary" />
                    &lt;/div>
                  )}
                &lt;/div>
              );
            })}
          &lt;/div>
        )}

        {/* Información del elemento seleccionado */}
        {selectedElement &amp;&amp; (
          &lt;div className="mt-6 pt-4 border-t space-y-4">
            &lt;div>
              &lt;h4 className="font-medium text-sm mb-2">{t('selectedElement')}&lt;/h4>
              &lt;div className="bg-muted/20 rounded p-3 text-xs space-y-1">
                &lt;div className="flex justify-between">
                  &lt;span className="text-muted-foreground">ID:&lt;/span>
                  &lt;span className="font-mono">{selectedElement.id}&lt;/span>
                &lt;/div>
                &lt;div className="flex justify-between">
                  &lt;span className="text-muted-foreground">Tipo:&lt;/span>
                  &lt;span className="font-mono">{selectedElement.tagName}&lt;/span>
                &lt;/div>
                {selectedElement.className &amp;&amp; (
                  &lt;div className="flex justify-between">
                    &lt;span className="text-muted-foreground">Clases:&lt;/span>
                    &lt;span className="font-mono">{selectedElement.className}&lt;/span>
                  &lt;/div>
                )}
              &lt;/div>
            &lt;/div>

            {/* PathDebugger - Solo para elementos &lt;path> */}
            {selectedElement.tagName === 'path' &amp;&amp; selectedElement.element &amp;&amp; (
              &lt;PathDebugger pathElement={selectedElement.element} />
            )}
          &lt;/div>
        )}

        {/* SVGMetadataEditor - Siempre visible cuando hay SVG */}
        {svgContent &amp;&amp; onSVGUpdate &amp;&amp; (
          &lt;div className="border-t pt-4">
            &lt;SVGMetadataEditor
              svgContent={svgContent}
              onUpdate={onSVGUpdate}
            />
          &lt;/div>
        )}

        {!selectedElement &amp;&amp; !svgContent &amp;&amp; (
          &lt;div className="mt-6 pt-4 border-t text-center text-muted-foreground">
            &lt;p className="text-sm">
              {t('selectElementToApplyStyles')}
            &lt;/p>
          &lt;/div>
        )}
      &lt;/div>

      {/* Modal de edición de estilos - Draggeable */}
      {editModalOpen &amp;&amp; ReactDOM.createPortal(
        &lt;>
          {/* Overlay */}
          &lt;div
            className="fixed inset-0 z-50 bg-black/50 backdrop-blur-sm"
            onClick={() => setEditModalOpen(false)}
          />

          {/* Modal Draggeable */}
          &lt;Draggable
            handle=".drag-handle"
            defaultPosition={{
              x: window.innerWidth / 2 - 250,
              y: window.innerHeight / 2 - 300
            }}
          >
            &lt;div
              className="style-panel-modal fixed z-[60] w-[500px] rounded-lg shadow-2xl"
              style={{
                left: 0,
                top: 0,
                transform: 'translate(-50%, -50%)',
                backgroundColor: 'var(--popover)',
              }}
            >
              {/* Header con drag handle */}
              &lt;div className="drag-handle flex items-center gap-2 p-4 border-b cursor-move bg-muted/20">
                &lt;GripVertical size={16} className="text-muted-foreground" />
                &lt;div className="flex-1">
                  &lt;h2 className="text-lg font-semibold">{t('editStyle')}&lt;/h2>
                  &lt;p className="text-sm text-muted-foreground">{t('editStyleDescription')}&lt;/p>
                &lt;/div>
              &lt;/div>

              {editingStyle &amp;&amp; (
                &lt;div className="space-y-4 p-4 max-h-[600px] overflow-y-auto">
              {/* Nombre del estilo */}
              &lt;div className="space-y-2">
                &lt;Label htmlFor="style-name">{t('styleName')}&lt;/Label>
                &lt;Input
                  id="style-name"
                  value={editingStyle.name}
                  onChange={(e) =>
                    setEditingStyle({ ...editingStyle, name: e.target.value })
                  }
                  placeholder={t('styleNamePlaceholder')}
                />
              &lt;/div>

              {/* Propiedades CSS */}
              &lt;div className="space-y-3">
                &lt;Label>{t('cssProperties')}&lt;/Label>
                &lt;div className="space-y-2 max-h-[300px] overflow-y-auto">
                  {editingStyle.properties.map((prop, index) => (
                    &lt;div key={index} className="flex gap-2">
                      &lt;Select
                        value={prop.key}
                        onValueChange={(value) => {
                          const newProps = [...editingStyle.properties];
                          newProps[index].key = value;
                          setEditingStyle({ ...editingStyle, properties: newProps });
                        }}
                      >
                        &lt;SelectTrigger className="w-[140px] text-xs font-mono">
                          &lt;SelectValue placeholder={t('propertyPlaceholder')} />
                        &lt;/SelectTrigger>
                        &lt;SelectContent>
                          {/* Mostrar la propiedad actual si no está en la lista */}
                          {prop.key &amp;&amp; !commonSVGProperties.includes(prop.key) &amp;&amp; (
                            &lt;SelectItem value={prop.key}>{prop.key}&lt;/SelectItem>
                          )}
                          {/* Mostrar propiedades disponibles */}
                          {commonSVGProperties.map((p) => (
                            &lt;SelectItem key={p} value={p}>
                              {p}
                            &lt;/SelectItem>
                          ))}
                        &lt;/SelectContent>
                      &lt;/Select>
                      {/* Input tipo color para propiedades de color */}
                      {(prop.key === 'fill' || prop.key === 'stroke' || prop.key.includes('color')) ? (
                        &lt;div className="flex gap-2 flex-1">
                          &lt;Input
                            type="color"
                            value={prop.value.startsWith('#') ? prop.value : '#000000'}
                            onChange={(e) => {
                              const newProps = [...editingStyle.properties];
                              newProps[index].value = e.target.value;
                              setEditingStyle({ ...editingStyle, properties: newProps });
                            }}
                            className="w-16 h-9 p-1 cursor-pointer"
                          />
                          &lt;Input
                            value={prop.value}
                            onChange={(e) => {
                              const newProps = [...editingStyle.properties];
                              newProps[index].value = e.target.value;
                              setEditingStyle({ ...editingStyle, properties: newProps });
                            }}
                            placeholder={t('valuePlaceholder')}
                            className="flex-1 text-xs font-mono"
                          />
                        &lt;/div>
                      ) : (
                        &lt;Input
                          value={prop.value}
                          onChange={(e) => {
                            const newProps = [...editingStyle.properties];
                            newProps[index].value = e.target.value;
                            setEditingStyle({ ...editingStyle, properties: newProps });
                          }}
                          placeholder={t('valuePlaceholder')}
                          className="flex-1 text-xs font-mono"
                        />
                      )}
                      &lt;Button
                        variant="ghost"
                        size="sm"
                        onClick={() => {
                          const newProps = editingStyle.properties.filter((_, i) => i !== index);
                          setEditingStyle({ ...editingStyle, properties: newProps });
                        }}
                        className="h-9 w-9 p-0"
                        title={t('deleteProperty')}
                      >
                        &lt;Trash2 size={14} />
                      &lt;/Button>
                    &lt;/div>
                  ))}
                &lt;/div>

                {/* Botón para agregar nueva propiedad */}
                &lt;Button
                  variant="outline"
                  size="sm"
                  onClick={() => {
                    const availableProps = getAvailableProperties();
                    const newKey = availableProps.length > 0 ? availableProps[0] : '';
                    setEditingStyle({
                      ...editingStyle,
                      properties: [...editingStyle.properties, { key: newKey, value: '' }]
                    });
                  }}
                  className="w-full"
                  disabled={getAvailableProperties().length === 0}
                >
                  &lt;Plus size={14} className="mr-1" />
                  {t('addProperty')}
                &lt;/Button>
                  &lt;/div>

                  {/* Botones de acción */}
                  &lt;div className="flex justify-between gap-2 pt-4 border-t">
                    &lt;Button
                      variant="destructive"
                      size="sm"
                      onClick={handleDeleteStyle}
                    >
                      &lt;Trash2 size={14} className="mr-1" />
                      {t('deleteStyle')}
                    &lt;/Button>
                    &lt;div className="flex gap-2">
                      &lt;Button
                        variant="outline"
                        onClick={() => {
                          setEditModalOpen(false);
                          setEditingStyle(null);
                        }}
                      >
                        {t('cancel')}
                      &lt;/Button>
                      &lt;Button onClick={handleSaveStyle}>
                        {t('saveChanges')}
                      &lt;/Button>
                    &lt;/div>
                  &lt;/div>
                &lt;/div>
              )}
            &lt;/div>
          &lt;/Draggable>
        &lt;/>,
        document.body
      )}
    &lt;/div>
  );
};

export default StylePanel;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CoordinateTransformer.html">CoordinateTransformer</a></li><li><a href="PathDataProcessor.html">PathDataProcessor</a></li><li><a href="SVGOptimizer.html">SVGOptimizer</a></li><li><a href="SVGWorld.html">SVGWorld</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AdvancedTools">AdvancedTools</a></li><li><a href="global.html#BezierHandleEditor">BezierHandleEditor</a></li><li><a href="global.html#CodeView">CodeView</a></li><li><a href="global.html#Container">Container</a></li><li><a href="global.html#DEFAULT_CONFIG">DEFAULT_CONFIG</a></li><li><a href="global.html#FileLoadDemo">FileLoadDemo</a></li><li><a href="global.html#LanguageSelector">LanguageSelector</a></li><li><a href="global.html#MousePointerIcon">MousePointerIcon</a></li><li><a href="global.html#MoveableWrapper">MoveableWrapper</a></li><li><a href="global.html#NodeEditor">NodeEditor</a></li><li><a href="global.html#PathDebugger">PathDebugger</a></li><li><a href="global.html#PerformanceMetrics">PerformanceMetrics</a></li><li><a href="global.html#SVGHierarchy">SVGHierarchy</a></li><li><a href="global.html#SVGHistory">SVGHistory</a></li><li><a href="global.html#SVGMetadataEditor">SVGMetadataEditor</a></li><li><a href="global.html#SVGViewer">SVGViewer</a></li><li><a href="global.html#SettingsModal">SettingsModal</a></li><li><a href="global.html#SettingsView">SettingsView</a></li><li><a href="global.html#StylePanel">StylePanel</a></li><li><a href="global.html#TextInput">TextInput</a></li><li><a href="global.html#absoluteToRelative">absoluteToRelative</a></li><li><a href="global.html#addNodeToPath">addNodeToPath</a></li><li><a href="global.html#applyTransform">applyTransform</a></li><li><a href="global.html#buildPathFromNodes">buildPathFromNodes</a></li><li><a href="global.html#buildPathString">buildPathString</a></li><li><a href="global.html#checkLocalStorageAvailable">checkLocalStorageAvailable</a></li><li><a href="global.html#checkSessionStorageAvailable">checkSessionStorageAvailable</a></li><li><a href="global.html#circleToPath">circleToPath</a></li><li><a href="global.html#clearLocalStorage">clearLocalStorage</a></li><li><a href="global.html#clearSessionStorage">clearSessionStorage</a></li><li><a href="global.html#closePath">closePath</a></li><li><a href="global.html#countElements">countElements</a></li><li><a href="global.html#createCoordinateTransformer">createCoordinateTransformer</a></li><li><a href="global.html#createPathDataProcessor">createPathDataProcessor</a></li><li><a href="global.html#createSVGOptimizer">createSVGOptimizer</a></li><li><a href="global.html#createSVGWorld">createSVGWorld</a></li><li><a href="global.html#ellipseToPath">ellipseToPath</a></li><li><a href="global.html#formatNumber">formatNumber</a></li><li><a href="global.html#getElementBBox">getElementBBox</a></li><li><a href="global.html#getLocalStorageSize">getLocalStorageSize</a></li><li><a href="global.html#getSessionStorageSize">getSessionStorageSize</a></li><li><a href="global.html#getTransformedBBox">getTransformedBBox</a></li><li><a href="global.html#moveElement">moveElement</a></li><li><a href="global.html#optimizeSVG">optimizeSVG</a></li><li><a href="global.html#parsePathCommand">parsePathCommand</a></li><li><a href="global.html#parsePathNodes">parsePathNodes</a></li><li><a href="global.html#parseTransform">parseTransform</a></li><li><a href="global.html#pointToHorizontalLine">pointToHorizontalLine</a></li><li><a href="global.html#pointToLineTo">pointToLineTo</a></li><li><a href="global.html#pointToMoveTo">pointToMoveTo</a></li><li><a href="global.html#pointToSmoothQuadraticBezier">pointToSmoothQuadraticBezier</a></li><li><a href="global.html#pointToVerticalLine">pointToVerticalLine</a></li><li><a href="global.html#pointsToArc">pointsToArc</a></li><li><a href="global.html#pointsToCubicBezier">pointsToCubicBezier</a></li><li><a href="global.html#pointsToPath">pointsToPath</a></li><li><a href="global.html#pointsToQuadraticBezier">pointsToQuadraticBezier</a></li><li><a href="global.html#pointsToSmoothCubicBezier">pointsToSmoothCubicBezier</a></li><li><a href="global.html#rectToPath">rectToPath</a></li><li><a href="global.html#relativeToAbsolute">relativeToAbsolute</a></li><li><a href="global.html#removeNodeFromPath">removeNodeFromPath</a></li><li><a href="global.html#rotateElement">rotateElement</a></li><li><a href="global.html#scaleElement">scaleElement</a></li><li><a href="global.html#serializeTransform">serializeTransform</a></li><li><a href="global.html#simplifyPath">simplifyPath</a></li><li><a href="global.html#svgToScreenCoords">svgToScreenCoords</a></li><li><a href="global.html#updateNodeInPath">updateNodeInPath</a></li><li><a href="global.html#useCoordinateTransformer">useCoordinateTransformer</a></li><li><a href="global.html#useHistory">useHistory</a></li><li><a href="global.html#useLocalStorage">useLocalStorage</a></li><li><a href="global.html#useMoveable">useMoveable</a></li><li><a href="global.html#usePanzoom">usePanzoom</a></li><li><a href="global.html#usePathDataProcessor">usePathDataProcessor</a></li><li><a href="global.html#usePerformance">usePerformance</a></li><li><a href="global.html#useSVGParser">useSVGParser</a></li><li><a href="global.html#useSVGStorage">useSVGStorage</a></li><li><a href="global.html#useSVGWorld">useSVGWorld</a></li><li><a href="global.html#useSessionStorage">useSessionStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Nov 17 2025 13:59:29 GMT+1300 (New Zealand Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
