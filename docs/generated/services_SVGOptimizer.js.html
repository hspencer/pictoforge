<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: services/SVGOptimizer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: services/SVGOptimizer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { optimize } from 'svgo';

/**
 * SVGOptimizer Service
 *
 * Servicio para optimizar SVG usando SVGO antes de la exportación.
 * Reduce el tamaño del archivo, mejora el rendimiento y asegura
 * estándares de calidad en la salida.
 *
 * Características:
 * - Reducción de precisión decimal (floatPrecision)
 * - Eliminación de atributos innecesarios
 * - Preservación de metadatos de accesibilidad (title, desc)
 * - Configuración personalizable
 */

/**
 * Configuración por defecto de SVGO
 */
const DEFAULT_CONFIG = {
  // Opciones globales
  floatPrecision: 4, // Reducir decimales a 4 dígitos
  multipass: true, // Múltiples pasadas de optimización

  // Plugins de optimización
  plugins: [
    // Preservar estructura básica
    {
      name: 'preset-default',
      params: {
        overrides: {
          // Preservar viewBox (crítico para responsive)
          removeViewBox: false,

          // Preservar IDs (necesarios para selección y manipulación)
          cleanupIds: false,

          // Preservar metadatos de accesibilidad
          removeTitle: false,
          removeDesc: false,

          // Preservar atributos de datos personalizados
          removeUnknownsAndDefaults: {
            keepDataAttrs: true,
            keepAriaAttrs: true,
            keepRoleAttr: true,
          },

          // Convertir colores a formato corto
          convertColors: {
            currentColor: true,
            names2hex: true,
            rgb2hex: true,
            shorthex: true,
            shortname: true,
          },

          // Reducir precisión de transformaciones
          convertTransform: {
            floatPrecision: 4,
          },

          // Reducir precisión de paths
          convertPathData: {
            floatPrecision: 4,
            transformPrecision: 5,
            removeUseless: true,
            convertToQ: true,
            convertToZ: true,
            straightCurves: true,
            lineShorthands: true,
            curveSmoothShorthands: true,
            utilizeAbsolute: true,
          },
        },
      },
    },

    // Limpiar atributos vacíos
    'removeEmptyAttrs',

    // Remover comentarios
    'removeComments',

    // Remover metadatos innecesarios (pero preservar title/desc)
    'removeMetadata',

    // Remover elementos ocultos
    'removeHiddenElems',

    // Simplificar estilos
    'minifyStyles',

    // Ordenar atributos para mejor compresión
    'sortAttrs',

    // Redondear números
    {
      name: 'cleanupNumericValues',
      params: {
        floatPrecision: 4,
      },
    },
  ],
};

/**
 * Clase SVGOptimizer
 */
export class SVGOptimizer {
  constructor(config = {}) {
    this.config = {
      ...DEFAULT_CONFIG,
      ...config,
      plugins: config.plugins || DEFAULT_CONFIG.plugins,
    };
  }

  /**
   * Optimiza un string SVG
   *
   * @param {string} svgString - Cadena SVG a optimizar
   * @param {Object} options - Opciones de optimización específicas
   * @returns {Promise&lt;{data: string, info: Object}>}
   */
  async optimize(svgString, options = {}) {
    try {
      const config = {
        ...this.config,
        ...options,
      };

      const result = optimize(svgString, config);

      return {
        data: result.data,
        info: {
          originalSize: svgString.length,
          optimizedSize: result.data.length,
          reduction: svgString.length - result.data.length,
          reductionPercent: (
            ((svgString.length - result.data.length) / svgString.length) *
            100
          ).toFixed(2),
        },
      };
    } catch (error) {
      console.error('❌ SVGOptimizer Error:', error);
      throw new Error(`Failed to optimize SVG: ${error.message}`);
    }
  }

  /**
   * Optimiza con configuración personalizada
   *
   * @param {string} svgString
   * @param {Object} customConfig
   * @returns {Promise&lt;{data: string, info: Object}>}
   */
  async optimizeWithConfig(svgString, customConfig) {
    return this.optimize(svgString, customConfig);
  }

  /**
   * Optimización agresiva (máxima reducción de tamaño)
   *
   * @param {string} svgString
   * @returns {Promise&lt;{data: string, info: Object}>}
   */
  async optimizeAgressive(svgString) {
    const aggressiveConfig = {
      floatPrecision: 2,
      plugins: [
        {
          name: 'preset-default',
          params: {
            overrides: {
              cleanupIds: {
                remove: true,
                minify: true,
                preserve: [],
              },
              removeViewBox: false,
              convertPathData: {
                floatPrecision: 2,
                transformPrecision: 3,
              },
            },
          },
        },
      ],
    };

    return this.optimize(svgString, aggressiveConfig);
  }

  /**
   * Optimización conservadora (preserva más información)
   *
   * @param {string} svgString
   * @returns {Promise&lt;{data: string, info: Object}>}
   */
  async optimizeConservative(svgString) {
    const conservativeConfig = {
      floatPrecision: 6,
      plugins: [
        {
          name: 'preset-default',
          params: {
            overrides: {
              cleanupIds: false,
              removeViewBox: false,
              removeTitle: false,
              removeDesc: false,
              convertPathData: {
                floatPrecision: 6,
                transformPrecision: 7,
              },
            },
          },
        },
      ],
    };

    return this.optimize(svgString, conservativeConfig);
  }

  /**
   * Añadir o actualizar metadatos de accesibilidad
   *
   * @param {string} svgString
   * @param {Object} metadata - { title: string, desc: string, lang: string }
   * @returns {string}
   */
  addAccessibilityMetadata(svgString, metadata = {}) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(svgString, 'image/svg+xml');
    const svg = doc.documentElement;

    // Añadir o actualizar role="img" para accesibilidad
    if (!svg.hasAttribute('role')) {
      svg.setAttribute('role', 'img');
    }

    // Añadir o actualizar lang
    if (metadata.lang &amp;&amp; !svg.hasAttribute('lang')) {
      svg.setAttribute('lang', metadata.lang);
    }

    // Generar ID único para aria-labelledby y aria-describedby
    const titleId = `svg-title-${Date.now()}`;
    const descId = `svg-desc-${Date.now()}`;

    // Manejar &lt;title>
    if (metadata.title) {
      let titleElement = svg.querySelector('title');
      if (!titleElement) {
        titleElement = doc.createElementNS('http://www.w3.org/2000/svg', 'title');
        svg.insertBefore(titleElement, svg.firstChild);
      }
      titleElement.textContent = metadata.title;
      titleElement.setAttribute('id', titleId);
      svg.setAttribute('aria-labelledby', titleId);
    }

    // Manejar &lt;desc>
    if (metadata.desc) {
      let descElement = svg.querySelector('desc');
      if (!descElement) {
        descElement = doc.createElementNS('http://www.w3.org/2000/svg', 'desc');
        // Insertar después de &lt;title> si existe
        const titleElement = svg.querySelector('title');
        if (titleElement) {
          titleElement.after(descElement);
        } else {
          svg.insertBefore(descElement, svg.firstChild);
        }
      }
      descElement.textContent = metadata.desc;
      descElement.setAttribute('id', descId);

      // Combinar aria-labelledby y aria-describedby
      if (metadata.title) {
        svg.setAttribute('aria-labelledby', `${titleId} ${descId}`);
      } else {
        svg.setAttribute('aria-describedby', descId);
      }
    }

    // Serializar de vuelta a string
    const serializer = new XMLSerializer();
    return serializer.serializeToString(svg);
  }

  /**
   * Pipeline completo: añadir metadatos + optimizar
   *
   * @param {string} svgString
   * @param {Object} metadata
   * @param {Object} optimizeOptions
   * @returns {Promise&lt;{data: string, info: Object}>}
   */
  async processForExport(svgString, metadata = {}, optimizeOptions = {}) {
    try {
      // 1. Añadir metadatos de accesibilidad
      let processedSvg = svgString;
      if (metadata.title || metadata.desc || metadata.lang) {
        processedSvg = this.addAccessibilityMetadata(svgString, metadata);
        console.log('✅ Metadata de accesibilidad añadidos');
      }

      // 2. Optimizar con SVGO
      const result = await this.optimize(processedSvg, optimizeOptions);

      console.log('✅ SVG Optimizado:', {
        originalSize: `${result.info.originalSize} bytes`,
        optimizedSize: `${result.info.optimizedSize} bytes`,
        reduction: `${result.info.reduction} bytes (${result.info.reductionPercent}%)`,
      });

      return result;
    } catch (error) {
      console.error('❌ Error en processForExport:', error);
      throw error;
    }
  }

  /**
   * Obtener configuración actual
   */
  getConfig() {
    return { ...this.config };
  }

  /**
   * Actualizar configuración
   */
  updateConfig(newConfig) {
    this.config = {
      ...this.config,
      ...newConfig,
    };
  }
}

/**
 * Factory function para crear instancia de SVGOptimizer
 *
 * @param {Object} config - Configuración personalizada
 * @returns {SVGOptimizer}
 */
export function createSVGOptimizer(config = {}) {
  return new SVGOptimizer(config);
}

/**
 * Función de conveniencia para optimización rápida
 *
 * @param {string} svgString
 * @param {Object} options
 * @returns {Promise&lt;string>}
 */
export async function optimizeSVG(svgString, options = {}) {
  const optimizer = createSVGOptimizer();
  const result = await optimizer.optimize(svgString, options);
  return result.data;
}

export default SVGOptimizer;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CoordinateTransformer.html">CoordinateTransformer</a></li><li><a href="PathDataProcessor.html">PathDataProcessor</a></li><li><a href="SVGOptimizer.html">SVGOptimizer</a></li><li><a href="SVGWorld.html">SVGWorld</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AdvancedTools">AdvancedTools</a></li><li><a href="global.html#BezierHandleEditor">BezierHandleEditor</a></li><li><a href="global.html#CodeView">CodeView</a></li><li><a href="global.html#Container">Container</a></li><li><a href="global.html#DEFAULT_CONFIG">DEFAULT_CONFIG</a></li><li><a href="global.html#FileLoadDemo">FileLoadDemo</a></li><li><a href="global.html#LanguageSelector">LanguageSelector</a></li><li><a href="global.html#MousePointerIcon">MousePointerIcon</a></li><li><a href="global.html#MoveableWrapper">MoveableWrapper</a></li><li><a href="global.html#NodeEditor">NodeEditor</a></li><li><a href="global.html#PathDebugger">PathDebugger</a></li><li><a href="global.html#PerformanceMetrics">PerformanceMetrics</a></li><li><a href="global.html#SVGHierarchy">SVGHierarchy</a></li><li><a href="global.html#SVGHistory">SVGHistory</a></li><li><a href="global.html#SVGMetadataEditor">SVGMetadataEditor</a></li><li><a href="global.html#SVGViewer">SVGViewer</a></li><li><a href="global.html#SettingsModal">SettingsModal</a></li><li><a href="global.html#SettingsView">SettingsView</a></li><li><a href="global.html#StylePanel">StylePanel</a></li><li><a href="global.html#TextInput">TextInput</a></li><li><a href="global.html#absoluteToRelative">absoluteToRelative</a></li><li><a href="global.html#addNodeToPath">addNodeToPath</a></li><li><a href="global.html#applyTransform">applyTransform</a></li><li><a href="global.html#buildPathFromNodes">buildPathFromNodes</a></li><li><a href="global.html#buildPathString">buildPathString</a></li><li><a href="global.html#checkLocalStorageAvailable">checkLocalStorageAvailable</a></li><li><a href="global.html#checkSessionStorageAvailable">checkSessionStorageAvailable</a></li><li><a href="global.html#circleToPath">circleToPath</a></li><li><a href="global.html#clearLocalStorage">clearLocalStorage</a></li><li><a href="global.html#clearSessionStorage">clearSessionStorage</a></li><li><a href="global.html#closePath">closePath</a></li><li><a href="global.html#countElements">countElements</a></li><li><a href="global.html#createCoordinateTransformer">createCoordinateTransformer</a></li><li><a href="global.html#createPathDataProcessor">createPathDataProcessor</a></li><li><a href="global.html#createSVGOptimizer">createSVGOptimizer</a></li><li><a href="global.html#createSVGWorld">createSVGWorld</a></li><li><a href="global.html#ellipseToPath">ellipseToPath</a></li><li><a href="global.html#formatNumber">formatNumber</a></li><li><a href="global.html#getElementBBox">getElementBBox</a></li><li><a href="global.html#getLocalStorageSize">getLocalStorageSize</a></li><li><a href="global.html#getSessionStorageSize">getSessionStorageSize</a></li><li><a href="global.html#getTransformedBBox">getTransformedBBox</a></li><li><a href="global.html#moveElement">moveElement</a></li><li><a href="global.html#optimizeSVG">optimizeSVG</a></li><li><a href="global.html#parsePathCommand">parsePathCommand</a></li><li><a href="global.html#parsePathNodes">parsePathNodes</a></li><li><a href="global.html#parseTransform">parseTransform</a></li><li><a href="global.html#pointToHorizontalLine">pointToHorizontalLine</a></li><li><a href="global.html#pointToLineTo">pointToLineTo</a></li><li><a href="global.html#pointToMoveTo">pointToMoveTo</a></li><li><a href="global.html#pointToSmoothQuadraticBezier">pointToSmoothQuadraticBezier</a></li><li><a href="global.html#pointToVerticalLine">pointToVerticalLine</a></li><li><a href="global.html#pointsToArc">pointsToArc</a></li><li><a href="global.html#pointsToCubicBezier">pointsToCubicBezier</a></li><li><a href="global.html#pointsToPath">pointsToPath</a></li><li><a href="global.html#pointsToQuadraticBezier">pointsToQuadraticBezier</a></li><li><a href="global.html#pointsToSmoothCubicBezier">pointsToSmoothCubicBezier</a></li><li><a href="global.html#rectToPath">rectToPath</a></li><li><a href="global.html#relativeToAbsolute">relativeToAbsolute</a></li><li><a href="global.html#removeNodeFromPath">removeNodeFromPath</a></li><li><a href="global.html#rotateElement">rotateElement</a></li><li><a href="global.html#scaleElement">scaleElement</a></li><li><a href="global.html#serializeTransform">serializeTransform</a></li><li><a href="global.html#simplifyPath">simplifyPath</a></li><li><a href="global.html#svgToScreenCoords">svgToScreenCoords</a></li><li><a href="global.html#updateNodeInPath">updateNodeInPath</a></li><li><a href="global.html#useCoordinateTransformer">useCoordinateTransformer</a></li><li><a href="global.html#useHistory">useHistory</a></li><li><a href="global.html#useLocalStorage">useLocalStorage</a></li><li><a href="global.html#useMoveable">useMoveable</a></li><li><a href="global.html#usePanzoom">usePanzoom</a></li><li><a href="global.html#usePathDataProcessor">usePathDataProcessor</a></li><li><a href="global.html#usePerformance">usePerformance</a></li><li><a href="global.html#useSVGParser">useSVGParser</a></li><li><a href="global.html#useSVGStorage">useSVGStorage</a></li><li><a href="global.html#useSVGWorld">useSVGWorld</a></li><li><a href="global.html#useSessionStorage">useSessionStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Nov 17 2025 13:59:29 GMT+1300 (New Zealand Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
