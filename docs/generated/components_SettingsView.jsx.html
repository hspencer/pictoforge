<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/SettingsView.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/SettingsView.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useRef } from 'react';
import { X, Plus, Trash2, Palette, MapPin, User, Building2, MessageSquare, Globe, Download, Upload } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { useI18n } from '@/hooks/useI18n';

/**
 * Vista de pantalla completa para configuraciÃ³n de opciones locales
 */
export const SettingsView = ({ isOpen, onClose, config, onSave }) => {
  const { t } = useI18n();
  const fileInputRef = useRef(null);

  const [localConfig, setLocalConfig] = useState({
    instanceName: config?.instanceName || '',
    author: config?.author || '',
    location: config?.location || { address: '', coordinates: null },
    language: config?.language || 'es',
    graphicStylePrompt: config?.graphicStylePrompt || '',
    customStyles: config?.customStyles || []
  });

  const [editingStyleIndex, setEditingStyleIndex] = useState(null);
  const [importError, setImportError] = useState(null);

  if (!isOpen) return null;

  /**
   * Actualiza un campo de configuraciÃ³n
   */
  const handleFieldChange = (field, value) => {
    setLocalConfig(prev => ({
      ...prev,
      [field]: value
    }));
  };

  /**
   * Actualiza la ubicaciÃ³n
   */
  const handleLocationChange = (address) => {
    setLocalConfig(prev => ({
      ...prev,
      location: { ...prev.location, address }
    }));
  };

  /**
   * Crea un nuevo estilo personalizado
   */
  const handleCreateStyle = () => {
    const newStyle = {
      id: Date.now().toString(),
      name: `Estilo ${localConfig.customStyles.length + 1}`,
      fill: '#000000',
      stroke: '#000000',
      strokeWidth: '1'
    };

    setLocalConfig(prev => ({
      ...prev,
      customStyles: [...prev.customStyles, newStyle]
    }));
    setEditingStyleIndex(localConfig.customStyles.length);
  };

  /**
   * Actualiza un estilo existente
   */
  const handleUpdateStyle = (index, field, value) => {
    setLocalConfig(prev => ({
      ...prev,
      customStyles: prev.customStyles.map((style, i) =>
        i === index ? { ...style, [field]: value } : style
      )
    }));
  };

  /**
   * Elimina un estilo
   */
  const handleDeleteStyle = (index) => {
    setLocalConfig(prev => ({
      ...prev,
      customStyles: prev.customStyles.filter((_, i) => i !== index)
    }));
    if (editingStyleIndex === index) {
      setEditingStyleIndex(null);
    }
  };

  /**
   * Exporta la configuraciÃ³n a un archivo JSON
   */
  const handleExport = () => {
    try {
      const exportData = {
        version: '1.0',
        exportDate: new Date().toISOString(),
        config: localConfig
      };

      const blob = new Blob([JSON.stringify(exportData, null, 2)], {
        type: 'application/json'
      });

      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `pictoforge-config-${Date.now()}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      console.log('âœ“ ConfiguraciÃ³n exportada exitosamente');
    } catch (error) {
      console.error('âœ— Error al exportar configuraciÃ³n:', error);
      alert('Error al exportar la configuraciÃ³n');
    }
  };

  /**
   * Importa la configuraciÃ³n desde un archivo JSON
   */
  const handleImport = (event) => {
    const file = event.target.files?.[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const content = e.target.result;
        const importedData = JSON.parse(content);

        // Validar estructura del archivo
        if (!importedData.config) {
          throw new Error('Formato de archivo invÃ¡lido');
        }

        // Validar campos requeridos
        const validConfig = {
          instanceName: importedData.config.instanceName || '',
          author: importedData.config.author || '',
          location: importedData.config.location || { address: '', coordinates: null },
          language: importedData.config.language || 'es',
          graphicStylePrompt: importedData.config.graphicStylePrompt || '',
          customStyles: Array.isArray(importedData.config.customStyles)
            ? importedData.config.customStyles
            : []
        };

        // Validar cada estilo personalizado (SettingsView usa estructura diferente)
        validConfig.customStyles = validConfig.customStyles.map(style => {
          // Si tiene la estructura de SettingsModal (con properties)
          if (style.properties) {
            return {
              id: style.id || Date.now().toString(),
              name: style.name || 'Estilo sin nombre',
              fill: style.properties.fill || '#000000',
              stroke: style.properties.stroke || '#000000',
              strokeWidth: style.properties['stroke-width'] || '1'
            };
          }
          // Si ya tiene la estructura de SettingsView
          return {
            id: style.id || Date.now().toString(),
            name: style.name || 'Estilo sin nombre',
            fill: style.fill || '#000000',
            stroke: style.stroke || '#000000',
            strokeWidth: style.strokeWidth || '1'
          };
        });

        setLocalConfig(validConfig);
        setImportError(null);
        console.log('âœ“ ConfiguraciÃ³n importada exitosamente');
        alert('ConfiguraciÃ³n importada exitosamente. No olvides guardar los cambios.');
      } catch (error) {
        console.error('âœ— Error al importar configuraciÃ³n:', error);
        setImportError('Error al importar el archivo. Verifica que sea un archivo vÃ¡lido.');
        alert('Error al importar la configuraciÃ³n. Verifica que el archivo sea vÃ¡lido.');
      }
    };

    reader.onerror = () => {
      console.error('âœ— Error al leer el archivo');
      setImportError('Error al leer el archivo');
      alert('Error al leer el archivo');
    };

    reader.readAsText(file);

    // Limpiar el input para permitir seleccionar el mismo archivo nuevamente
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  /**
   * Abre el selector de archivos
   */
  const handleImportClick = () => {
    fileInputRef.current?.click();
  };

  /**
   * Guarda la configuraciÃ³n
   */
  const handleSave = () => {
    onSave(localConfig);
  };

  return (
    &lt;div className="fixed inset-0 z-50 bg-background flex flex-col">
      {/* Header */}
      &lt;header className="flex items-center justify-between p-4 border-b bg-muted/20">
        &lt;div className="flex items-center gap-3">
          &lt;h1 className="text-xl font-bold tracking-tight">
            Opciones Locales de PictoForge
          &lt;/h1>
        &lt;/div>

        &lt;Button
          variant="ghost"
          size="sm"
          onClick={onClose}
          title="Cerrar"
        >
          &lt;X size={20} />
        &lt;/Button>
      &lt;/header>

      {/* Content */}
      &lt;div className="flex-1 overflow-y-auto p-6">
        &lt;div className="max-w-4xl mx-auto space-y-8">
          {/* InformaciÃ³n de Instancia */}
          &lt;section className="space-y-4">
            &lt;h2 className="text-lg font-semibold flex items-center gap-2">
              &lt;Building2 size={20} />
              InformaciÃ³n de Instancia
            &lt;/h2>
            &lt;div className="grid gap-4">
              &lt;div>
                &lt;Label htmlFor="instanceName">Nombre de la Instancia&lt;/Label>
                &lt;Input
                  id="instanceName"
                  value={localConfig.instanceName}
                  onChange={(e) => handleFieldChange('instanceName', e.target.value)}
                  placeholder="Ej: PictoForge Chile"
                />
              &lt;/div>
            &lt;/div>
          &lt;/section>

          {/* Autor */}
          &lt;section className="space-y-4">
            &lt;h2 className="text-lg font-semibold flex items-center gap-2">
              &lt;User size={20} />
              Autor
            &lt;/h2>
            &lt;div>
              &lt;Label htmlFor="author">Nombre del Autor (para crÃ©ditos)&lt;/Label>
              &lt;Input
                id="author"
                value={localConfig.author}
                onChange={(e) => handleFieldChange('author', e.target.value)}
                placeholder="Ej: Juan PÃ©rez"
              />
            &lt;/div>
          &lt;/section>

          {/* UbicaciÃ³n */}
          &lt;section className="space-y-4">
            &lt;h2 className="text-lg font-semibold flex items-center gap-2">
              &lt;MapPin size={20} />
              UbicaciÃ³n
            &lt;/h2>
            &lt;div>
              &lt;Label htmlFor="location">DirecciÃ³n&lt;/Label>
              &lt;Input
                id="location"
                value={localConfig.location.address}
                onChange={(e) => handleLocationChange(e.target.value)}
                placeholder="Ej: Santiago, Chile"
              />
              &lt;p className="text-xs text-muted-foreground mt-1">
                IntegraciÃ³n con mapa disponible en futuras versiones
              &lt;/p>
            &lt;/div>
          &lt;/section>

          {/* Idioma */}
          &lt;section className="space-y-4">
            &lt;h2 className="text-lg font-semibold flex items-center gap-2">
              &lt;Globe size={20} />
              Idioma
            &lt;/h2>
            &lt;div>
              &lt;Label htmlFor="language">Seleccionar Idioma&lt;/Label>
              &lt;Select
                value={localConfig.language}
                onValueChange={(value) => handleFieldChange('language', value)}
              >
                &lt;SelectTrigger id="language">
                  &lt;SelectValue placeholder="Seleccionar idioma" />
                &lt;/SelectTrigger>
                &lt;SelectContent>
                  &lt;SelectItem value="es">EspaÃ±ol&lt;/SelectItem>
                  &lt;SelectItem value="en">English&lt;/SelectItem>
                  &lt;SelectItem value="pt">PortuguÃªs&lt;/SelectItem>
                  &lt;SelectItem value="fr">FranÃ§ais&lt;/SelectItem>
                &lt;/SelectContent>
              &lt;/Select>
            &lt;/div>
          &lt;/section>

          {/* Prompt de Estilo GrÃ¡fico */}
          &lt;section className="space-y-4">
            &lt;h2 className="text-lg font-semibold flex items-center gap-2">
              &lt;MessageSquare size={20} />
              Prompt General del Estilo GrÃ¡fico
            &lt;/h2>
            &lt;div>
              &lt;Label htmlFor="graphicStylePrompt">DescripciÃ³n del Estilo&lt;/Label>
              &lt;Textarea
                id="graphicStylePrompt"
                value={localConfig.graphicStylePrompt}
                onChange={(e) => handleFieldChange('graphicStylePrompt', e.target.value)}
                placeholder="Describe el estilo grÃ¡fico general para esta instancia..."
                rows={4}
              />
            &lt;/div>
          &lt;/section>

          {/* Estilos Personalizados */}
          &lt;section className="space-y-4">
            &lt;div className="flex items-center justify-between">
              &lt;h2 className="text-lg font-semibold flex items-center gap-2">
                &lt;Palette size={20} />
                Estilos Personalizados
              &lt;/h2>
              &lt;Button
                variant="outline"
                size="sm"
                onClick={handleCreateStyle}
              >
                &lt;Plus size={16} className="mr-1" />
                Nuevo Estilo
              &lt;/Button>
            &lt;/div>

            {localConfig.customStyles.length === 0 ? (
              &lt;div className="text-center py-8 text-muted-foreground border rounded-lg">
                &lt;Palette size={32} className="mx-auto mb-2 opacity-50" />
                &lt;p className="text-sm">No hay estilos personalizados&lt;/p>
                &lt;p className="text-xs mt-1">Crea uno nuevo para comenzar&lt;/p>
              &lt;/div>
            ) : (
              &lt;div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {localConfig.customStyles.map((style, index) => (
                  &lt;div
                    key={style.id}
                    className="border rounded-lg p-4 space-y-3"
                  >
                    &lt;div className="flex items-center justify-between">
                      &lt;Input
                        value={style.name}
                        onChange={(e) => handleUpdateStyle(index, 'name', e.target.value)}
                        className="font-medium h-8"
                      />
                      &lt;Button
                        variant="ghost"
                        size="sm"
                        onClick={() => handleDeleteStyle(index)}
                        className="h-8 w-8 p-0 ml-2"
                      >
                        &lt;Trash2 size={14} />
                      &lt;/Button>
                    &lt;/div>

                    {/* Preview Circle */}
                    &lt;div className="flex justify-center">
                      &lt;svg width="60" height="60" viewBox="0 0 60 60">
                        &lt;circle
                          cx="30"
                          cy="30"
                          r="25"
                          fill={style.fill}
                          stroke={style.stroke}
                          strokeWidth={style.strokeWidth}
                        />
                      &lt;/svg>
                    &lt;/div>

                    {/* Color Pickers */}
                    &lt;div className="space-y-2">
                      &lt;div>
                        &lt;Label className="text-xs">Fill&lt;/Label>
                        &lt;div className="flex gap-2">
                          &lt;input
                            type="color"
                            value={style.fill}
                            onChange={(e) => handleUpdateStyle(index, 'fill', e.target.value)}
                            className="h-8 w-12 cursor-pointer"
                          />
                          &lt;Input
                            value={style.fill}
                            onChange={(e) => handleUpdateStyle(index, 'fill', e.target.value)}
                            className="h-8 text-xs font-mono"
                          />
                        &lt;/div>
                      &lt;/div>

                      &lt;div>
                        &lt;Label className="text-xs">Stroke&lt;/Label>
                        &lt;div className="flex gap-2">
                          &lt;input
                            type="color"
                            value={style.stroke}
                            onChange={(e) => handleUpdateStyle(index, 'stroke', e.target.value)}
                            className="h-8 w-12 cursor-pointer"
                          />
                          &lt;Input
                            value={style.stroke}
                            onChange={(e) => handleUpdateStyle(index, 'stroke', e.target.value)}
                            className="h-8 text-xs font-mono"
                          />
                        &lt;/div>
                      &lt;/div>

                      &lt;div>
                        &lt;Label className="text-xs">Stroke Width&lt;/Label>
                        &lt;Input
                          type="number"
                          value={style.strokeWidth}
                          onChange={(e) => handleUpdateStyle(index, 'strokeWidth', e.target.value)}
                          className="h-8 text-xs"
                          min="0"
                          step="0.5"
                        />
                      &lt;/div>
                    &lt;/div>
                  &lt;/div>
                ))}
              &lt;/div>
            )}
          &lt;/section>

          {/* Exportar/Importar ConfiguraciÃ³n */}
          &lt;section className="space-y-4 pt-4 border-t">
            &lt;h2 className="text-lg font-semibold flex items-center gap-2">
              ðŸ’¾ Exportar/Importar ConfiguraciÃ³n
            &lt;/h2>

            &lt;div className="bg-muted/30 rounded-lg p-4 space-y-4">
              &lt;p className="text-sm text-muted-foreground">
                Guarda tu configuraciÃ³n en un archivo JSON para respaldo o para compartirla con otros.
              &lt;/p>

              &lt;div className="flex gap-3">
                &lt;Button
                  variant="outline"
                  onClick={handleExport}
                  className="flex-1"
                >
                  &lt;Download size={16} className="mr-2" />
                  Exportar ConfiguraciÃ³n
                &lt;/Button>

                &lt;Button
                  variant="outline"
                  onClick={handleImportClick}
                  className="flex-1"
                >
                  &lt;Upload size={16} className="mr-2" />
                  Importar ConfiguraciÃ³n
                &lt;/Button>
              &lt;/div>

              {/* Input oculto para seleccionar archivos */}
              &lt;input
                ref={fileInputRef}
                type="file"
                accept=".json,application/json"
                onChange={handleImport}
                className="hidden"
              />

              {importError &amp;&amp; (
                &lt;div className="text-sm text-destructive bg-destructive/10 p-3 rounded">
                  {importError}
                &lt;/div>
              )}

              &lt;p className="text-sm text-muted-foreground">
                âš ï¸ Al importar, la configuraciÃ³n actual serÃ¡ reemplazada. AsegÃºrate de exportar tu configuraciÃ³n actual antes de importar otra.
              &lt;/p>
            &lt;/div>
          &lt;/section>
        &lt;/div>
      &lt;/div>

      {/* Footer con botones */}
      &lt;footer className="p-4 border-t bg-muted/20 flex justify-end gap-2">
        &lt;Button
          variant="outline"
          onClick={onClose}
        >
          Cancelar
        &lt;/Button>
        &lt;Button
          onClick={handleSave}
        >
          Guardar ConfiguraciÃ³n
        &lt;/Button>
      &lt;/footer>
    &lt;/div>
  );
};

export default SettingsView;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CoordinateTransformer.html">CoordinateTransformer</a></li><li><a href="PathDataProcessor.html">PathDataProcessor</a></li><li><a href="SVGOptimizer.html">SVGOptimizer</a></li><li><a href="SVGWorld.html">SVGWorld</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AdvancedTools">AdvancedTools</a></li><li><a href="global.html#BezierHandleEditor">BezierHandleEditor</a></li><li><a href="global.html#CodeView">CodeView</a></li><li><a href="global.html#Container">Container</a></li><li><a href="global.html#DEFAULT_CONFIG">DEFAULT_CONFIG</a></li><li><a href="global.html#FileLoadDemo">FileLoadDemo</a></li><li><a href="global.html#LanguageSelector">LanguageSelector</a></li><li><a href="global.html#MousePointerIcon">MousePointerIcon</a></li><li><a href="global.html#MoveableWrapper">MoveableWrapper</a></li><li><a href="global.html#NodeEditor">NodeEditor</a></li><li><a href="global.html#PathDebugger">PathDebugger</a></li><li><a href="global.html#PerformanceMetrics">PerformanceMetrics</a></li><li><a href="global.html#SVGHierarchy">SVGHierarchy</a></li><li><a href="global.html#SVGHistory">SVGHistory</a></li><li><a href="global.html#SVGMetadataEditor">SVGMetadataEditor</a></li><li><a href="global.html#SVGViewer">SVGViewer</a></li><li><a href="global.html#SettingsModal">SettingsModal</a></li><li><a href="global.html#SettingsView">SettingsView</a></li><li><a href="global.html#StylePanel">StylePanel</a></li><li><a href="global.html#TextInput">TextInput</a></li><li><a href="global.html#absoluteToRelative">absoluteToRelative</a></li><li><a href="global.html#addNodeToPath">addNodeToPath</a></li><li><a href="global.html#applyTransform">applyTransform</a></li><li><a href="global.html#buildPathFromNodes">buildPathFromNodes</a></li><li><a href="global.html#buildPathString">buildPathString</a></li><li><a href="global.html#checkLocalStorageAvailable">checkLocalStorageAvailable</a></li><li><a href="global.html#checkSessionStorageAvailable">checkSessionStorageAvailable</a></li><li><a href="global.html#circleToPath">circleToPath</a></li><li><a href="global.html#clearLocalStorage">clearLocalStorage</a></li><li><a href="global.html#clearSessionStorage">clearSessionStorage</a></li><li><a href="global.html#closePath">closePath</a></li><li><a href="global.html#countElements">countElements</a></li><li><a href="global.html#createCoordinateTransformer">createCoordinateTransformer</a></li><li><a href="global.html#createPathDataProcessor">createPathDataProcessor</a></li><li><a href="global.html#createSVGOptimizer">createSVGOptimizer</a></li><li><a href="global.html#createSVGWorld">createSVGWorld</a></li><li><a href="global.html#ellipseToPath">ellipseToPath</a></li><li><a href="global.html#formatNumber">formatNumber</a></li><li><a href="global.html#getElementBBox">getElementBBox</a></li><li><a href="global.html#getLocalStorageSize">getLocalStorageSize</a></li><li><a href="global.html#getSessionStorageSize">getSessionStorageSize</a></li><li><a href="global.html#getTransformedBBox">getTransformedBBox</a></li><li><a href="global.html#moveElement">moveElement</a></li><li><a href="global.html#optimizeSVG">optimizeSVG</a></li><li><a href="global.html#parsePathCommand">parsePathCommand</a></li><li><a href="global.html#parsePathNodes">parsePathNodes</a></li><li><a href="global.html#parseTransform">parseTransform</a></li><li><a href="global.html#pointToHorizontalLine">pointToHorizontalLine</a></li><li><a href="global.html#pointToLineTo">pointToLineTo</a></li><li><a href="global.html#pointToMoveTo">pointToMoveTo</a></li><li><a href="global.html#pointToSmoothQuadraticBezier">pointToSmoothQuadraticBezier</a></li><li><a href="global.html#pointToVerticalLine">pointToVerticalLine</a></li><li><a href="global.html#pointsToArc">pointsToArc</a></li><li><a href="global.html#pointsToCubicBezier">pointsToCubicBezier</a></li><li><a href="global.html#pointsToPath">pointsToPath</a></li><li><a href="global.html#pointsToQuadraticBezier">pointsToQuadraticBezier</a></li><li><a href="global.html#pointsToSmoothCubicBezier">pointsToSmoothCubicBezier</a></li><li><a href="global.html#rectToPath">rectToPath</a></li><li><a href="global.html#relativeToAbsolute">relativeToAbsolute</a></li><li><a href="global.html#removeNodeFromPath">removeNodeFromPath</a></li><li><a href="global.html#rotateElement">rotateElement</a></li><li><a href="global.html#scaleElement">scaleElement</a></li><li><a href="global.html#serializeTransform">serializeTransform</a></li><li><a href="global.html#simplifyPath">simplifyPath</a></li><li><a href="global.html#svgToScreenCoords">svgToScreenCoords</a></li><li><a href="global.html#updateNodeInPath">updateNodeInPath</a></li><li><a href="global.html#useCoordinateTransformer">useCoordinateTransformer</a></li><li><a href="global.html#useHistory">useHistory</a></li><li><a href="global.html#useLocalStorage">useLocalStorage</a></li><li><a href="global.html#useMoveable">useMoveable</a></li><li><a href="global.html#usePanzoom">usePanzoom</a></li><li><a href="global.html#usePathDataProcessor">usePathDataProcessor</a></li><li><a href="global.html#usePerformance">usePerformance</a></li><li><a href="global.html#useSVGParser">useSVGParser</a></li><li><a href="global.html#useSVGStorage">useSVGStorage</a></li><li><a href="global.html#useSVGWorld">useSVGWorld</a></li><li><a href="global.html#useSessionStorage">useSessionStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Nov 17 2025 13:59:29 GMT+1300 (New Zealand Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
